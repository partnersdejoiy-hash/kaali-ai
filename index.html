<!DOCTYPE html>
<html>
<head>
<title>KAALI AI</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="icon" href="kaali.png">
<style>
html, body {
 margin: 0;
 padding: 0;
 background: black;
 color: white;
 font-family: Arial;
 height: 100%;
 overflow: hidden;
}
.container {
 display: flex;
 flex-direction: column;
 height: 100%;
 width: 100%;
}
.header {
 text-align: center;
 padding: 10px;
 border-bottom: 1px solid #222;
}
.logo { width: 60px; animation: glow 3s infinite; }
.title { color: gold; font-size: 20px; }
#messages {
 flex: 1;
 overflow-y: auto;
 padding: 10px;
}
.user { background: #222; padding: 10px; margin: 6px; border-radius: 10px; }
.kaali { background:black; border-left:4px solid gold; padding:10px; margin:6px; border-radius:10px; }
.kaali a { color: #3cc6ff; font-weight: bold; text-decoration: none; }
.inputArea {
 display: flex;
 padding: 10px;
 border-top: 1px solid #222;
}
input {
 flex: 1;
 padding: 10px;
 border-radius: 10px;
 border: none;
 font-size: 16px;
}
button {
 background: gold;
 border: none;
 padding: 10px 16px;
 margin-left: 6px;
 border-radius: 10px;
 cursor: pointer;
 font-weight: bold;
}
@keyframes glow {
 0%{filter:drop-shadow(0 0 2px gold);}
 50%{filter:drop-shadow(0 0 12px gold);}
 100%{filter:drop-shadow(0 0 2px gold);}
}
</style>
</head>
<body>

<div class="container">
 <div class="header">
   <img src="kaali.png" class="logo">
   <div class="title">KAALI AI</div>
 </div>

 <div id="messages"></div>

 <div class="inputArea">
   <input id="input" placeholder="Ask KAALI anything...">
   <button onclick="send()">Send</button>
   <button onclick="startVoice()">ðŸŽ¤</button>
   <button onclick="speakLast()">ðŸ”Š</button>
 </div>
</div>

<script>
let history = [{
 role:"assistant",
 content:"âœ¨ Namaste! I am KAALI â€” your divine guide at DEJOIY. How may I assist you today?"
}];
let lastReply="";

document.getElementById("messages").innerHTML =
 "<div class='kaali'>âœ¨ Namaste! I am KAALI â€” your divine guide at DEJOIY. How may I assist you today?</div>";

async function send(){
 let input = document.getElementById("input");
 let msg = input.value.trim(); if(!msg) return;
 input.value="";
 let box = document.getElementById("messages");

 box.innerHTML += `<div class='user'>${msg}</div>`;
 history.push({role:"user",content:msg});
 box.innerHTML += `<div class='kaali'>KAALI is thinking...</div>`;
 box.scrollTop = box.scrollHeight;

 let res = await fetch("/api/chat",{
   method:"POST",
   headers:{"Content-Type":"application/json"},
   body:JSON.stringify({messages:history})
 });
 let data = await res.json();

 box.removeChild(box.lastChild);
 lastReply = data.reply;
 history.push({role:"assistant",content:data.reply});

 let replyHTML = data.reply.replace(
   /https:\/\/[^\s]+/g,
   url => `<a href="${url}" target="_blank">${url}</a>`
 );

 box.innerHTML += `<div class='kaali'>${replyHTML}</div>`;
 box.scrollTop = box.scrollHeight;
}

// Enter key
document.getElementById("input").addEventListener("keydown", e=>{
 if(e.key==="Enter") send();
});

// Voice play
function speakLast(){
 let text = lastReply.replace(/[^\w\s.,]/gi,'');
 let s = new SpeechSynthesisUtterance(text);
 s.rate = 0.9; s.pitch = 1.3;
 let voices = speechSynthesis.getVoices();
 s.voice = voices.find(v=>v.name.includes("Female"))||voices[1];
 speechSynthesis.speak(s);
}

// Voice input
function startVoice(){
 let rec = new webkitSpeechRecognition();
 rec.lang="en-IN";
 rec.onresult = e=>{
   document.getElementById("input").value = e.results[0][0].transcript;
 };
 rec.start();
}
</script>

</body>
</html>
