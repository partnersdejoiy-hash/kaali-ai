<!DOCTYPE html>
<html>

<head>

<title>KAALI AI</title>

<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="icon" href="kaali.png">

<style>

html,body{
margin:0;
padding:0;
background:black;
color:white;
font-family:Arial;
height:100%;
}

/* Adaptive Layout */

.container{
width:100%;
max-width:900px;
height:100%;
margin:auto;
display:flex;
flex-direction:column;
}

/* Header */

.header{
text-align:center;
padding:10px;
border-bottom:1px solid #222;
}

.logo{
width:70px;
animation:glow 3s infinite;
}

.title{
color:gold;
font-size:22px;
}

/* Messages */

#messages{
flex:1;
overflow:auto;
padding:15px;
}

.user{
background:#222;
padding:10px;
border-radius:10px;
margin:6px;
}

.kaali{
background:black;
border-left:4px solid gold;
padding:10px;
border-radius:10px;
margin:6px;
}

.typing{
color:gold;
}

/* Input */

.inputArea{
display:flex;
padding:10px;
border-top:1px solid #222;
}

input{
flex:1;
padding:12px;
border-radius:10px;
border:none;
}

button{
background:gold;
border:none;
padding:10px 14px;
margin-left:5px;
border-radius:10px;
cursor:pointer;
}

/* Recording Status */

#recordStatus{
text-align:center;
color:gold;
font-size:14px;
height:20px;
}

/* Glow */

@keyframes glow{
0%{filter:drop-shadow(0px 0px 2px gold);}
50%{filter:drop-shadow(0px 0px 12px gold);}
100%{filter:drop-shadow(0px 0px 2px gold);}
}

</style>

</head>

<body>

<div class="container">

<div class="header">

<img src="kaali.png" class="logo">

<div class="title">KAALI AI</div>

</div>

<div id="messages"></div>

<div class="inputArea">

<input id="input" placeholder="Ask KAALI anything...">

<button onclick="send()">Send</button>

<button onclick="record()">ðŸŽ¤</button>

<button onclick="speak(lastReply)">ðŸ”Š</button>

</div>

<div id="recordStatus"></div>

</div>


<script>

/* MEMORY */

let history=[];
let lastReply="";


/* OPENING MESSAGE */

let greeting=

"âœ¨ Namaste. I am KAALI â€” your mystical guide at DEJOIY. I can help you shop smarter, track orders, discover products and services. How may I assist you today? ðŸ”®";

document.getElementById("messages").innerHTML=

"<div class='kaali'>"+greeting+"</div>";

history.push({
role:"assistant",
content:greeting
});


/* SEND MESSAGE */

async function send(){

let input=document.getElementById("input");

let msg=input.value.trim();

if(!msg) return;

input.value="";

let box=document.getElementById("messages");


box.innerHTML+=

"<div class='user'>"+msg+"</div>";


history.push({
role:"user",
content:msg
});


box.innerHTML+=

"<div class='kaali typing'>KAALI is thinking...</div>";

box.scrollTop=box.scrollHeight;


let res=await fetch("/api/chat",{

method:"POST",

headers:{
"Content-Type":"application/json"
},

body:JSON.stringify({
messages:history
})

});


let data=await res.json();


box.removeChild(box.lastChild);


lastReply=data.reply;


history.push({
role:"assistant",
content:data.reply
});


box.innerHTML+=

"<div class='kaali'>"+data.reply+"</div>";

box.scrollTop=box.scrollHeight;

}



/* ENTER KEY */

document.getElementById("input")

.addEventListener("keydown",function(e){

if(e.key==="Enter"){
send();
}

});



/* GODDESS VOICE */

function speak(text){

let clean=text.replace(/[^\w\s.,]/gi,'');

let speech=new SpeechSynthesisUtterance(clean);

let voices=speechSynthesis.getVoices();

speech.voice=

voices.find(v=>v.name.includes("Female"))
||
voices.find(v=>v.name.includes("Zira"))
||
voices[0];


speech.rate=0.85;
speech.pitch=1.25;
speech.volume=1;

speechSynthesis.cancel();

speechSynthesis.speak(speech);

}



/* RECORD */

let rec;

if(window.webkitSpeechRecognition){

rec=new webkitSpeechRecognition();

rec.lang="en-IN";

rec.onstart=function(){

document.getElementById("recordStatus")

.innerHTML="ðŸŽ¤ Listening...";

}

rec.onend=function(){

document.getElementById("recordStatus")

.innerHTML="";

}

rec.onresult=function(e){

document.getElementById("input").value=

e.results[0][0].transcript;

}

}


function record(){

rec.start();

}

</script>

</body>

</html>
